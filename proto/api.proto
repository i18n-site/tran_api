syntax = "proto3";

package api;

service Api {
  rpc tran(Job) returns (stream TranResult);
  rpc version(Void) returns (Version);
}

message Void {}

message Version {
  uint32 major = 1;
  uint32 minor = 2;
  uint32 patch = 3;
}

enum FileType {
  MD = 0;
  YML = 1;
}

message Update
{
  uint32 from_lang = 1;
  uint32 to_lang = 2;
  string txt = 3;
  bytes src_hash = 4;
  FileType file_type = 5;
}

message Tran
{
  uint32 from_lang = 1;
  repeated uint32 to_lang_li = 2;
  string txt = 3;
  string path = 4;
}

message Job
{
  repeated Update update_li = 1;
  repeated Tran tran_li = 2;
}

message Traned
{
  uint32 from_lang = 1;
  uint32 to_lang = 2;
  string txt = 3;
  bytes src_hash = 4;
  string path = 5;
}

message ErrUnsupportExt {
  uint32 from_lang = 1;
  string path = 2;
}

message ErrParse {
  uint32 from_lang = 1;
  string path = 2;
  string msg = 3;
}

// 欠费
message ErrOverdraw {
  uint64 debt = 1;
  uint32 currency = 2;
}

message ErrTokenInvalid {}

message ErrTran {
  uint32 from_lang = 1;
  uint32 to_lang = 2;
  string path = 3;
  string msg = 4;
}

message TranResult {
  oneof kind {
    Traned traned = 1;
    ErrTran err_tran = 2;
    ErrTokenInvalid err_token_invalid = 3;
    ErrOverdraw err_overdraw = 4;
    ErrUnsupportExt err_unsupport_ext = 5;
    ErrParse err_parse = 6;
  };
}
